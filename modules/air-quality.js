/**
 * air-quality.js
 * "–≠–∫—Å–ø–µ—Ä—Ç-—ç–∫–æ–ª–æ–≥": –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–±–∑–∞—Ü –æ –∫–∞—á–µ—Å—Ç–≤–µ –≤–æ–∑–¥—É—Ö–∞ –∏ –ø—ã–ª—å—Ü–µ.
 */
import { GoogleGenerativeAI } from "@google/generative-ai";

const HEADING = "üå¨Ô∏è –ö–∞—á–µ—Å—Ç–≤–æ –≤–æ–∑–¥—É—Ö–∞";

export async function generateAirQualitySection(airData, geminiConfig) {
  if (!airData) {
    return `${HEADING}\n\n–î–∞–Ω–Ω—ã–µ –æ –∫–∞—á–µ—Å—Ç–≤–µ –≤–æ–∑–¥—É—Ö–∞ —Å–µ–≥–æ–¥–Ω—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.`;
  }

  const prompt = `
–¢–≤–æ—è —Ä–æ–ª—å: –≠–∫–æ–ª–æ–≥-–∞–Ω–∞–ª–∏—Ç–∏–∫, –ø–∏—à—É—â–∏–π –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω–æ–≥–æ –±–ª–æ–≥–∞.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –ù–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö JSON, –Ω–∞–ø–∏—Å–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–π (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è),
–ø–æ–Ω—è—Ç–Ω—ã–π –∏ –ø–æ–ª–µ–∑–Ω—ã–π –∞–±–∑–∞—Ü –æ –∫–∞—á–µ—Å—Ç–≤–µ –≤–æ–∑–¥—É—Ö–∞ –∏ —É—Ä–æ–≤–Ω–µ –ø—ã–ª—å—Ü—ã –≤ –†–∏–≥–µ.
–î–∞–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç –∏ –¥–µ–ª–∞–π —ç—Ç–æ –ø–æ-–¥—Ä—É–∂–µ—Å–∫–∏, –±—É–¥—Ç–æ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—à—å –∑–Ω–∞–∫–æ–º—ã–º –ø–æ–∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ —Å–µ–±–µ.

–î–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
${JSON.stringify(airData, null, 2)}

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞: "–î—ã—à–∏—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ! –ö–∞—á–µ—Å—Ç–≤–æ –≤–æ–∑–¥—É—Ö–∞ –≤ –†–∏–≥–µ —Å–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω–æ–µ
(–∏–Ω–¥–µ–∫—Å AQI ${airData.european_aqi}), –∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –ø—ã–ª—å—Ü—ã –±–µ—Ä—ë–∑—ã –∏ —Ç—Ä–∞–≤
–Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ. –û—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –ø—Ä–æ–≥—É–ª–æ–∫ –∏ –ø—Ä–æ–≤–µ—Ç—Ä–∏–≤–∞–Ω–∏—è –ø–æ–º–µ—â–µ–Ω–∏–π."
`;

  try {
    const model = geminiConfig.genAI.getGenerativeModel({ model: geminiConfig.modelName });
    const result = await model.generateContent(prompt);
    return `${HEADING}\n\n${result.response.text().trim()}`;
  } catch (error) {
    console.warn(`    -> –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–∞ –æ –∫–∞—á–µ—Å—Ç–≤–µ –≤–æ–∑–¥—É—Ö–∞: ${error.message}`);
    return `${HEADING}\n\n–ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –≤–æ–∑–¥—É—Ö–∞ –ø—Ä–æ–≤–µ—Å—Ç–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å.`;
  }
}
