/**
 * global-events.js
 * * "–≠–∫—Å–ø–µ—Ä—Ç" –ø–æ –º–∏—Ä–æ–≤—ã–º —Å–æ–±—ã—Ç–∏—è–º. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–±–∑–∞—Ü —Ç–µ–∫—Å—Ç–∞
 * –æ —Å–∞–º—ã—Ö –∑–Ω–∞—á–∏–º—ã—Ö –∫–∞—Ç–∞–∫–ª–∏–∑–º–∞—Ö –Ω–∞ –ø–ª–∞–Ω–µ—Ç–µ.
 */
import { GoogleGenerativeAI } from "@google/generative-ai";

const HEADING = "üåç –°–æ–±—ã—Ç–∏—è –≤ –º–∏—Ä–µ";

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –æ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö.
 * @param {object} eventsData –î–∞–Ω–Ω—ã–µ –æ—Ç nasa-api.
 * @param {object} geminiConfig –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Gemini (genAI, model, generationConfig).
 * @returns {Promise<string>} –ì–æ—Ç–æ–≤—ã–π –∞–±–∑–∞—Ü —Ç–µ–∫—Å—Ç–∞.
 */
export async function generateGlobalEventsSection(eventsData, geminiConfig) {
    const { genAI, modelName, generationConfig } = geminiConfig;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤–æ–æ–±—â–µ –æ —á–µ–º –ø–∏—Å–∞—Ç—å
    const hasEvents = Object.values(eventsData).some(arr => arr.length > 0);
    if (!hasEvents) {
        return `${HEADING}\n\n–ù–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∞—Ä–µ–Ω–µ —Å–µ–≥–æ–¥–Ω—è –Ω–∞ —É–¥–∏–≤–ª–µ–Ω–∏–µ —Å–ø–æ–∫–æ–π–Ω–æ, –∑–Ω–∞—á–∏–º—ã—Ö –ø—Ä–∏—Ä–æ–¥–Ω—ã—Ö –∫–∞—Ç–∞–∫–ª–∏–∑–º–æ–≤ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ.`;
    }

    const prompt = `
–¢–≤–æ—è —Ä–æ–ª—å: –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –æ–±–æ–∑—Ä–µ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Ä–æ–¥–Ω—ã—Ö —è–≤–ª–µ–Ω–∏–π.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –ù–∞–ø–∏—Å–∞—Ç—å –æ–¥–∏–Ω –∞–±–∑–∞—Ü, –∫—Ä–∞—Ç–∫–æ summarizing 1-2 —Å–∞–º—ã—Ö –∑–Ω–∞—á–∏–º—ã—Ö —Å–æ–±—ã—Ç–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ. –°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ —Å–∞–º–æ–º –º–æ—â–Ω–æ–º –∏–ª–∏ –Ω–µ–æ–±—ã—á–Ω–æ–º. –ù–µ –ø–µ—Ä–µ—á–∏—Å–ª—è–π –≤—Å—ë. –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å—Ç–∏–ª–µ "–ü–æ–∫–∞ —É –Ω–∞—Å —Ç—É—Ç —Å–≤–æ–∏ –∑–∞–±–æ—Ç—ã, –ø–ª–∞–Ω–µ—Ç–∞ –∂–∏–≤–µ—Ç —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é...". –ü–∏—à–∏ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –∏ —É–≤–ª–µ—á—ë–Ω–Ω–æ, —Å–ª–æ–≤–Ω–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—à—å –Ω–æ–≤–æ—Å—Ç–∏ –ø—Ä–∏—è—Ç–µ–ª—è–º –∑–∞ —á–∞—à–∫–æ–π –∫–æ—Ñ–µ.

–î–ê–ù–ù–´–ï –û –°–û–ë–´–¢–ò–Ø–•:
${JSON.stringify(eventsData, null, 2)}
`;

    const model = genAI.getGenerativeModel({ model: modelName, generationConfig });
    const result = await model.generateContent(prompt);
    return `${HEADING}\n\n${result.response.text().trim()}`;
}
