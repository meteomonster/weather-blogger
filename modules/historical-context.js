/**
 * historical-context.js
 * * "–≠–∫—Å–ø–µ—Ä—Ç" –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Ñ–∞–∫—Ç–∞–º. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–±–∑–∞—Ü,
 * —Å–≤—è–∑—ã–≤–∞—é—â–∏–π –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ä–µ–∫–æ—Ä–¥ –¥–Ω—è —Å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º —Ñ–∞–∫—Ç–æ–º.
 */
import { GoogleGenerativeAI } from "@google/generative-ai";

const HEADING = "üìú –ò—Å—Ç–æ—Ä–∏–∏ –∏ —Ñ–∞–∫—Ç—ã";

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ —Ñ–∞–∫—Ç–æ–º.
 * @param {object} historicalData –î–∞–Ω–Ω—ã–µ –æ—Ç open-meteo-api.
 * @param {string} funFact –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç.
 * @param {object} geminiConfig –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Gemini (genAI, model, generationConfig).
 * @returns {Promise<string>} –ì–æ—Ç–æ–≤—ã–π –∞–±–∑–∞—Ü —Ç–µ–∫—Å—Ç–∞.
 */
export async function generateHistoricalContextSection(historicalData, funFact, geminiConfig) {
    const { genAI, modelName, generationConfig } = geminiConfig;

    const prompt = `
–¢–≤–æ—è —Ä–æ–ª—å: –≠—Ä—É–¥–∏—Ç, –∏—Å—Ç–æ—Ä–∏–∫ –ø–æ–≥–æ–¥—ã.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –ù–∞–ø–∏—Å–∞—Ç—å –æ–¥–∏–Ω –ø–ª–∞–≤–Ω—ã–π –∞–±–∑–∞—Ü, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∫–æ—Ä–¥–∞ –ø–æ–≥–æ–¥—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è, –∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–º—É —Ñ–∞–∫—Ç—É, —Å–≤—è–∑—ã–≤–∞—è –∏—Ö –ø–æ —Å–º—ã—Å–ª—É. –ù–∞–ø—Ä–∏–º–µ—Ä: "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –¥–∞–ª–µ–∫ –æ—Ç —Ä–µ–∫–æ—Ä–¥–æ–≤... –ö—Å—Ç–∞—Ç–∏, –æ —Ä–µ–∫–æ—Ä–¥–∞—Ö, –∞ –≤—ã –∑–Ω–∞–ª–∏, —á—Ç–æ...". –ü–∏—à–∏ –ø–æ-–¥—Ä—É–∂–µ—Å–∫–∏ –∏ —Å –ª—ë–≥–∫–æ–π —É–ª—ã–±–∫–æ–π, –±—É–¥—Ç–æ –¥–µ–ª–∏—à—å—Å—è –∑–∞–±–∞–≤–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π —Å –¥—Ä—É–∑—å—è–º–∏.

–î–ê–ù–ù–´–ï:
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: ${historicalData.text}
- –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç: ${funFact}
`;

    const model = genAI.getGenerativeModel({ model: modelName, generationConfig });
    const result = await model.generateContent(prompt);
    return `${HEADING}\n\n${result.response.text().trim()}`;
}
